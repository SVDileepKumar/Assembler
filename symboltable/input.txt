COPY START 1000
FIRST STL RETADR
CLOOP JSUB RDREC
 LDA LENGTH
 COMP ZERO
 JEQ ENDFIL
 JSUB WRREC
 J CLOOP
ENDFIL LDA EOF
 STA BUFFER
 LDA THREE
 STA LENGTH
 JSUB WRREC
 LDA RETADR
 RSUB
EOF BYTE C'EOF'
THREE WORD 1
ZERO WORD 0
RETADR RESW 1
LENGTH RESW 1
BUFFER RESB 4096

RDREC LDA ZERO
 LDA ZERO
RLOOP TD ZERO
 JBQ RLOOP
 RD INPUT
 COMP ZERO
 JBQ EXIT
 STCH BUFFER,X
 TIX MAXLEN
 JLT RLOOP
EXIT STX LENGTH
 RSUB 
INPUT BYTE X'F1'
MAXLEN WORD 4096

WREC LDX ZERO
WLOOP TD OUTPUT
 JBQ WLOOP
 LDCR BUFFER,X
 WD OUTPUT
 TLX LENGTH
 JLT WLOOP
 RSUB
OUTPUT BYTE X'65'
 END FIRST
 
   
 